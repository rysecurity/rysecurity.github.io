<!DOCTYPE html> <html lang="en, ar"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group | </title> <meta name="author" content=" "> <meta name="description" content="Three paths to attack protected user and mitigation strategies"> <meta name="keywords" content="CyberSecurity, Pentesing, Hacking, Defense"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/192x192.jpg?4cd79c9ad0146cf0a2be01ce9b7ead10"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://rysecurity.github.io/blog/2024/images/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group</h1> <p class="post-meta"> Created in August 06, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/active-directory"> <i class="fa-solid fa-hashtag fa-sm"></i> Active-Directory</a>   ·   <a href="/blog/category/active-directory"> <i class="fa-solid fa-tag fa-sm"></i> Active-Directory</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p><b>What is the Protected Users Group?</b></p> <p>The Protected Users group is a security feature introduced in Windows Server 2012 R2 and later versions of Active Directory. This group is designed to enhance the security of accounts by applying stringent security policies that mitigate certain types of credential theft attacks. These policies are aimed at limiting the authentication methods and protocols that members of this group can use, thereby reducing the risk of credential exposure and misuse.</p> <p><b>Key Features</b></p> <p>1.Protected Users security group memberships restrict members to only use Advanced Encryption Standards (AES) for Kerberos. Members of the Protected Users group must be able to authenticate using AES.</p> <p>2.No NTLM Authentication: NTLM authentication is disabled for members of the Protected Users group. NTLM is a less secure protocol and is more susceptible to credential theft attacks like pass-the-hash.</p> <p>3.No Digest Authentication or CredSSP: These weaker authentication methods are disallowed, minimizing the risk of credential theft through insecure protocols.</p> <p>4.Kerberos Ticket Restrictions: The lifetime of Kerberos Ticket Granting Tickets (TGTs) for Protected Users is limited to 4 hours by default, and these tickets cannot be renewed. This reduces the window during which a stolen ticket can be misused.</p> <p>5.No Cached Credentials: Credentials for members of the Protected Users group are not cached on the local machine. This prevents attackers from retrieving cached credentials if they gain physical or remote access to a computer.</p> <p>6.Interactive Logon Restrictions: Members cannot log on interactively to computers that do not support the security policies enforced by the Protected Users group. This ensures these high-value accounts are only used on secure and trusted systems.</p> <p><b>Why Use the Protected Users Group?</b></p> <p>The primary reason for utilizing the Protected Users group is to provide enhanced security for high-value accounts. These accounts are often targeted by attackers due to their elevated permissions and access to sensitive data.</p> <p><b>Potential Attacks</b></p> <p>Despite the enhanced security measures provided by the Protected Users group, attackers may still attempt to target these accounts. Understanding these potential attacks and how to mitigate them is crucial.</p> <p>let’s say we have a user “admin2”, who is a regular domain admin. We performed a password spray attack and gain access allowing us to dump the lsass process and obtain its hash.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/1.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 855px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/2.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Next, we added “admin2” to the protected users group and attempt the password spray and pass-the-hash attacks.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/3.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br>This time, we receive an error (status account restriction) indicating that it no longer works.<br></p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/4.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 755px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/5.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 755px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><b> Finally, </b> we dump the lsass process again and find that there is no hash available</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/3-1.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <font size="4"> <b> In the first attack scenario, </b> we can target the protected users group (admin2). If we manage to crack the obtained NTLM hash before, we can use the Rubeus to generate an AES256 hash using the clear text password. </font> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/6.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <font size="4"> Using Rubeus, we can then successfully request a TGT ticket. </font> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/7.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><b> In the second attack scenario, </b> if we gain access to a machine where the admin2 user is already signed in, we can dump the TGT ticket.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/8.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Next, we can successfully import it.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/9.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><b> In the third attack scenario, </b> password spray attack on users in protected group, we can target a specific user by using the Netexec with –Kerberos flag, as shown below.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/10.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 555px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><b> Mitigation Strategies </b></p> <ol> <li> <p>Using a complex password: A strong password typically combines uppercase and lowercase letters, numbers, and special characters, making it harder for attackeers to guess or crack. Avoid using easily guessable information like birthdays or common words. Regularly updating your passwords and using unique ones for different accounts further enhances your security.</p> </li> <li> <p>Regular Monitoring and Auditing: Continuously monitor and audit the activities of members in the Protected Users group. Look for suspicious logins and unusual activities that may indicate a compromise.</p> </li> <li> <p>Use Secure Systems: Ensure that members of the Protected Users group only log in to systems that are up-to-date with security patches and that support the necessary security measures.</p> </li> <li> <p>Implement Additional Layers of Security: Use additional security measures such as multi-factor authentication (MFA), privileged access management (PAM) solutions, and network segmentation to further protect high-value accounts.</p> </li> <li> <p>Educate and Train Users: Regularly educate and train users on security best practices and the importance of safeguarding their credentials. Awareness can significantly reduce the risk of credential theft.</p> </li> </ol> <p><b> Conclusion </b></p> <p>The Protected Users group in Active Directory is a powerful tool for enhancing the security of accounts by enforcing stringent security policies and mitigating common credential theft attacks. By understanding what this group is, why it should be used, when to use it, and the potential attacks against it, organizations can effectively safeguard their most of the accounts and ensure a higher level of security across their Active Directory environment. Regular monitoring, system updates, additional security measures, and user education are key components in maintaining the integrity of the Protected Users group and the overall security posture of the organization.</p> <p><b> Additional Resources </b></p> <p>To further understand the Protected Users group and its implementation, refer to the following resources:</p> <p>https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group</p> <p>https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/how-to-configure-protected-accounts</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/images1/">Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group (Arabic)</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 . </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"projects",description:"",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"post-enhancing-security-in-active-directory-a-comprehensive-guide-to-protected-users-group-arabic",title:"Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group (Arabic)...",description:"Three paths to attack protected user and mitigation strategies",section:"Posts",handler:()=>{window.location.href="/blog/2024/images1/"}},{id:"post-enhancing-security-in-active-directory-a-comprehensive-guide-to-protected-users-group",title:"Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group",description:"Three paths to attack protected user and mitigation strategies",section:"Posts",handler:()=>{window.location.href="/blog/2024/images/"}},{id:"projects-soon",title:"Soon",description:"",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/rayan-almutairi-8817a8177","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>