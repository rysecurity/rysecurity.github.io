<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en, ar"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://rysecurity.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://rysecurity.github.io/" rel="alternate" type="text/html" hreflang="en, ar"/><updated>2024-08-11T15:25:31+00:00</updated><id>https://rysecurity.github.io/feed.xml</id><title type="html">blank</title><subtitle>Exploring the World of Cybersecurity; Learn, Explore, Secure </subtitle><entry><title type="html">Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group</title><link href="https://rysecurity.github.io/blog/2024/images/" rel="alternate" type="text/html" title="Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group"/><published>2024-08-06T21:01:00+00:00</published><updated>2024-08-06T21:01:00+00:00</updated><id>https://rysecurity.github.io/blog/2024/images</id><content type="html" xml:base="https://rysecurity.github.io/blog/2024/images/"><![CDATA[<p><b>What is the Protected Users Group?</b></p> <p>The Protected Users group is a security feature introduced in Windows Server 2012 R2 and later versions of Active Directory. This group is designed to enhance the security of accounts by applying stringent security policies that mitigate certain types of credential theft attacks. These policies are aimed at limiting the authentication methods and protocols that members of this group can use, thereby reducing the risk of credential exposure and misuse.</p> <p><b>Key Features</b></p> <p>1.Protected Users security group memberships restrict members to only use Advanced Encryption Standards (AES) for Kerberos. Members of the Protected Users group must be able to authenticate using AES.</p> <p>2.No NTLM Authentication: NTLM authentication is disabled for members of the Protected Users group. NTLM is a less secure protocol and is more susceptible to credential theft attacks like pass-the-hash.</p> <p>3.No Digest Authentication or CredSSP: These weaker authentication methods are disallowed, minimizing the risk of credential theft through insecure protocols.</p> <p>4.Kerberos Ticket Restrictions: The lifetime of Kerberos Ticket Granting Tickets (TGTs) for Protected Users is limited to 4 hours by default, and these tickets cannot be renewed. This reduces the window during which a stolen ticket can be misused.</p> <p>5.No Cached Credentials: Credentials for members of the Protected Users group are not cached on the local machine. This prevents attackers from retrieving cached credentials if they gain physical or remote access to a computer.</p> <p>6.Interactive Logon Restrictions: Members cannot log on interactively to computers that do not support the security policies enforced by the Protected Users group. This ensures these high-value accounts are only used on secure and trusted systems.</p> <p><b>Why Use the Protected Users Group?</b></p> <p>The primary reason for utilizing the Protected Users group is to provide enhanced security for high-value accounts. These accounts are often targeted by attackers due to their elevated permissions and access to sensitive data.</p> <p><b>Potential Attacks</b></p> <p>Despite the enhanced security measures provided by the Protected Users group, attackers may still attempt to target these high-value accounts. Understanding these potential attacks and how to mitigate them is crucial.</p> <p>let’s say we have a user “admin2”, who is a regular domain admin. We performed a password spray attack and gain access allowing us to dump the lsass process and obtain its hash.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/1.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 855px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/2.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Next, we added “admin2” to the protected users group and attempt the password spray and pass-the-hash attacks.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/3.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><br/>This time, we receive an error (status account restriction) indicating that it no longer works.<br/></p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/4.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 755px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/5.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 755px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><b> Finally, </b> we dump the lsass process again and find that there is no hash available</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/3-1.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <font size="4"> <b> In the first attack scenario, </b> we can target the protected users group (admin2). If we manage to crack the obtained NTLM hash before, we can use the Rubeus to generate an AES256 hash using the clear text password. </font> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/6.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <font size="4"> Using Rubeus, we can then successfully request a TGT ticket. </font> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/7.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><b> In the second attack scenario, </b> if we gain access to a machine where the admin2 user is already signed in, we can dump the TGT ticket.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/8.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Next, we can successfully import it.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/9.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><b> In the third attack scenario, </b> password spray attack on users in protected group, we can target a specific user by using the Netexec with –Kerberos flag, as shown below.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/10.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 555px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><b> Mitigation Strategies </b></p> <ol> <li> <p>Using a complex password: A strong password typically combines uppercase and lowercase letters, numbers, and special characters, making it harder for attackeers to guess or crack. Avoid using easily guessable information like birthdays or common words. Regularly updating your passwords and using unique ones for different accounts further enhances your security.</p> </li> <li> <p>Regular Monitoring and Auditing: Continuously monitor and audit the activities of members in the Protected Users group. Look for suspicious logins and unusual activities that may indicate a compromise.</p> </li> <li> <p>Use Secure Systems: Ensure that members of the Protected Users group only log in to systems that are up-to-date with security patches and that support the necessary security measures.</p> </li> <li> <p>Implement Additional Layers of Security: Use additional security measures such as multi-factor authentication (MFA), privileged access management (PAM) solutions, and network segmentation to further protect high-value accounts.</p> </li> <li> <p>Educate and Train Users: Regularly educate and train users on security best practices and the importance of safeguarding their credentials. Awareness can significantly reduce the risk of credential theft.</p> </li> </ol> <p><b> Conclusion </b></p> <p>The Protected Users group in Active Directory is a powerful tool for enhancing the security of high-value accounts by enforcing stringent security policies and mitigating common credential theft attacks. By understanding what this group is, why it should be used, when to use it, and the potential attacks against it, organizations can effectively safeguard their most of the high-value accounts and ensure a higher level of security across their Active Directory environment. Regular monitoring, system updates, additional security measures, and user education are key components in maintaining the integrity of the Protected Users group and the overall security posture of the organization.</p> <p><b> Additional Resources </b></p> <p>To further understand the Protected Users group and its implementation, refer to the following resources:</p> <p><a href="https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group">Microsoft Protected Users Security Group</a></p> <p><a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/how-to-configure-protected-accounts">Microsoft Guidance about how to configure protected accounts</a></p>]]></content><author><name></name></author><category term="Active-Directory"/><category term="Active-Directory"/><summary type="html"><![CDATA[Three paths to attack protected user and mitigation strategies]]></summary></entry><entry><title type="html">Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group (Arabic)</title><link href="https://rysecurity.github.io/blog/2024/images1/" rel="alternate" type="text/html" title="Enhancing Security in Active Directory; A Comprehensive Guide to Protected Users Group (Arabic)"/><published>2024-08-06T21:01:00+00:00</published><updated>2024-08-06T21:01:00+00:00</updated><id>https://rysecurity.github.io/blog/2024/images1</id><content type="html" xml:base="https://rysecurity.github.io/blog/2024/images1/"><![CDATA[<p><b> ؟ ما هو قروب المستخدمين المحميين </b></p> <p>قروب المستخدمين المحميين هي ميزة أمان مقدمة في ويندوز سيرفر 2012 تم تصميم هذا القروب لتعزيز أمان الحسابات ذات الصلاحيات العالية والإصدارات الأحدث من من خلال تطبيق سياسات أمنية صارمة تخفف من أنواع معينة من هجمات سرقة كلمات المرور. تهدف هذه السياسات إلى الحد من أساليب وبروتوكولات المصادقة التي يمكن لأعضاء هذا القروب استخدامها، ومن ثم تقلل من مخاطر كشف كلمات المرور وإساءة استخدامها.</p> <p><b> :المميزات </b></p> <p>.(AES) يتم تقيد اعضاء "المستخدمين المحميين" لاستخدام معايير التشفير المتقدمة #</p> <p>NTLM لأعضاء قروب المستخدمين المحميين. يعد NTLM authentication يتم تعطيل <b>:NTLM authentication لايتم استعمال #</b></p> <p>.Pass-the-hash بروتوكول أقل أمانا وأكثر عرضة لهجمات سرقة كلمات المرور مثل</p> <p>للمستخدمين المحميين تكون على مدة 4 ساعات بشكل Kerberos (TGT) <b>: Kerberos تم تقليل عمر تذكرة#</b></p> <p>.افتراضي. وهذا يقلل من الفترة التي يمكن خلالها إساءة استخدام التذكرة المسروقة</p> <p>لايتم تخزين كلمات المرور مؤقتا على الكمبيوتر <b>:(no cached credentials) لا يتم تخزين كلمات المرور #</b></p> <p>.Lsass وبهاذا الحل يتم منع المهاجمين من الحصول على كلمات المرور المخزنه في</p> <p>لا يمكن للأعضاء تسجيل الدخول بشكل تفاعلي الى اجهزة <b>:(Interactive Logon Restrictions) تم تقيد تسجيل الدخول التفاعلي #</b></p> <p>الكمبيوتر التي لا تدعم سياسات الأمان التي تفرضها قروب المستخدمين المحميين. وهذا يضمن استخدام هذه الحسابات عالية القيمة.</p> <p>.فقط على أنظمة امنة وموثوقة</p> <p><b>لماذا نستخدم قروب المستخدمين المحميين؟ </b></p> <p>السبب الرئيسي لاستخدام قروب "المستخدمين المحميين" هو توفير أمان محسّن للحسابات ذات الصلاحيات العالية,</p> <p>والمستخدمين الآخرين ذو (Service accounts) وحسابات الخدمة (Domain admins) مثل حسابات المسؤولين</p> <p>.الصلاحيات العالية. غالبًا ما يتم استهداف هذه الحسابات من قبل المهاجمين بسبب صلاحياتهم العالية </p> <p><b>متى يجب استخدام مجموعة المستخدمين المحميين؟ </b></p> <p>يفضل استخدام قروب "المستخدمين المحميين" للحسابات التي تتطلب أعلى مستوى من الأمان نظرًا لطبيعتها المميزة</p> <p>أو بسبب صلاحيتها للوصول إلى البيانات الحساسة. فيما يلي بعض السيناريوهات التي يكون فيها إضافة مستخدمين إلى</p> <p><b>:هذه المجموعة مفيدة</b></p> <p>.الحسابات ذات الصلاحيات الإدارية:<b>(Admin accounts) الحسابات الإدارية</b></p> <p>قد تستفيد بعض حسابات الخدمة عالية الصلاحيات التي تدير البنية التحتية أو <b>:(Service accounts) حسابات الخدمة</b></p> <p>.البيانات الحساسة من إجراءات الأمان الإضافية التي توفرها قروب المستخدمين المحميين</p> <p>المستخدمون الحساسون: أي حسابات مستخدمين تتعامل مع معلومات حساسة أو سرية، أو لديها صلاحيات عالية، يجب</p> <p>.أن تؤخذ بعين الاعتبار</p> <p><b>:الهجمات المحتملة </b></p> <p>على الرغم من التدابير الأمنية المحسنة التي يوفرها قروب "المستخدمون المحميون"، قد يستمر المهاجمون في محاولة </p> <p>.استهداف هذه الحسابات. نحتاج نفهم هاذي الهجمات المحتملة وكيفية التخفيف منها </p> <p>password spray سنقوم بتنفيذ هجوم ,(Domain Admin) ويملك صلاحية "admin2" لنفترض أن لدينا يوزر</p> <p>.الخاص لنفس المستخدم hash والحصول على lsass dump وثم الحصول على الرقم والوصول للجهاز ومن ثم عملنا</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/1.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 855px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/2.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>. pass-the-hash و password spray وسيتم عمل protected users group إلى "admin2" الان سيتم اضافة المستخدم</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/3.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/4.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 755px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/5.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 755px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>protected users group هاذي المرة يتم الرد علينا برسالة مختلفة عن السابق, بعد اضافة المستخدم في</p> <p>خاص بالمستخدم hash مرة أخرى وتبين أنه لا يوجد اي lsass dump وأخيرًا، سيتم عمل</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/3-1.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>crack ntlm hash إذا تمكنا من protected users group (admin2) سيناريو الهجوم الأول، يمكننا استهداف</p> <p>باستخدام كلمة مرور AES256 لإنشاء تذكرة Rubeus الذي تم الحصول عليها سابقا، فيمكننا استخدام</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/6.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>بنجاحTGT يمكننا بعد ذلك طلب تذكرة Rubeus باستخدام</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/7.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>TGT فيمكننا الحصول على تذكرة ,"admin2" سيناريو الهجوم الثاني، إذا تمكنا من الوصول إلى جهاز تم تسجيل دخول المستخدم</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/8.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>من ثم، يمكننا استيرادها بنجاح.</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/9.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 455px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>يمكننا استهداف مستخدم محدد باستخدام protected users group على password spray سيناريو الهجوم الثالث،</p> <p>Kerberos– مع تحديد Netexec</p> <div class="row" style="text-align: center;"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/10.JPG" class="img-fluid rounded z-depth-1" width="100%" height="auto" style=" max-width: 555px; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><b>:كيفية التصدي</b></p> <p>استخدام كلمة مرور معقدة: عادةً ما تجمع كلمة المرور القوية بين الأحرف الكبيرة والصغيرة والأرقام والعلامات الخاصة، مما يجعل من#</p> <p>الصعب على المهاجمين تخمينها أو اختراقها. تجنب استخدام معلومات يمكن تخمينها بسهولة مثل أعياد الميلاد أو الكلمات الشائعة.</p> <p>إن تحديث كلمات المرور بانتظام واستخدام كلمات مرور فريدة لحسابات مختلفة يعزز من أمانك.</p> <p>المراقبة والتدقيق المنتظم: مراقبة وتدقيق أنشطة الأعضاء في قروب المستخدمين المحميين بشكل مستمر. ابحث عن عمليات تسجيل الدخول#</p> <p>المشبوهة والأنشطة غير العادية التي قد تشير إلى وجود اختراق.</p> <p>استخدام الأنظمة الآمنة: تأكد من أن أعضاء قروب المستخدمين المحميين يسجلون الدخول فقط إلى الأنظمة التي تحتوي على التحديثات#</p> <p>الأمنية وتدعم تدابير الأمان اللازمة</p> <p>Network segmentation و PAM ,MFA اضافة طبقات أمان إضافية مثل: <b>استخدام تدابير أمان إضافية #</b></p> <p>تثقيف وتدريب المستخدمين: تثقيف وتدريب المستخدمين بانتظام على أفضل ممارسات الأمان وأهمية حماية كلمات المرور الخاصة بهم#</p> <p><b>خاتمة</b></p> <p>اضافة قوية لتعزيز أمان الحسابات ذات الصلاحيات العالية Active Directory تعد مجموعة "المستخدمين المحميين" في</p> <p>,من خلال فرض سياسات أمان صارمة والتخفيف من هجمات سرقة كلمات المرور. من خلال فهم ماهو هذه القروب</p> <p>ولماذا يجب استخدامة، ومتى يتم استخدامها، والهجمات المحتملة ضده، يمكن للمؤسسات حماية حساباتها الأكثر أهمية</p> <p>الخاصة بها. تعد المراقبة المنتظمة وتحديثات Active Directory بشكل فعال, وضمان مستوى أعلى من الأمان عبر بيئة </p> <p>."النظام والإجراءات الأمنية الإضافية تساعد في الحفاظ على سلامة قروب "المستخدمين المحميين</p> <p>:لفهم قروب المستخدمين المحميين وتنفيذها بشكل أفضل، راجع المصادر التالية</p> <p>https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group</p> <p>https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/how-to-configure-protected-accounts</p>]]></content><author><name></name></author><category term="Active-Directory"/><category term="Active-Directory"/><summary type="html"><![CDATA[Three paths to attack protected user and mitigation strategies]]></summary></entry></feed>